{"version":3,"sources":["../../../src/config/__tests__/findProjectRootSync.test.ts"],"sourcesContent":["import {join} from 'node:path'\n\nimport {afterEach, beforeEach, describe, expect, test, vi} from 'vitest'\n\nimport {findProjectRootSync} from '../findProjectRootSync'\n\n// Mock node:fs since configPathsSync uses it directly\nvi.mock('node:fs', async () => {\n  const actual = await vi.importActual('node:fs')\n  return {\n    ...actual,\n    existsSync: vi.fn(),\n    readFileSync: vi.fn(),\n  }\n})\n\ndescribe('findProjectRootSync', () => {\n  const mockCwd = '/mock/project/path'\n\n  beforeEach(() => {\n    vi.clearAllMocks()\n  })\n\n  afterEach(() => {\n    vi.resetAllMocks()\n  })\n\n  test('finds a TypeScript studio config in the current directory', async () => {\n    const {existsSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(mockCwd, 'sanity.config.ts')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: mockCwd,\n      path: join(mockCwd, 'sanity.config.ts'),\n      type: 'studio',\n    })\n  })\n\n  test('finds a JavaScript studio config in the current directory', async () => {\n    const {existsSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(mockCwd, 'sanity.config.js')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: mockCwd,\n      path: join(mockCwd, 'sanity.config.js'),\n      type: 'studio',\n    })\n  })\n\n  test('finds a TypeScript app config in the current directory', async () => {\n    const {existsSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(mockCwd, 'sanity.cli.ts')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: mockCwd,\n      path: join(mockCwd, 'sanity.cli.ts'),\n      type: 'app',\n    })\n  })\n\n  test('finds a JavaScript app config in the current directory', async () => {\n    const {existsSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(mockCwd, 'sanity.cli.js')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: mockCwd,\n      path: join(mockCwd, 'sanity.cli.js'),\n      type: 'app',\n    })\n  })\n\n  test('prioritizes studio config over app config when both are present', async () => {\n    const {existsSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(mockCwd, 'sanity.config.ts') || path === join(mockCwd, 'sanity.cli.ts')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: mockCwd,\n      path: join(mockCwd, 'sanity.config.ts'),\n      type: 'studio',\n    })\n  })\n\n  test('recursively searches parent directories for config', async () => {\n    const {existsSync} = await import('node:fs')\n    const parentPath = '/mock/project'\n\n    vi.mocked(existsSync).mockImplementation((path) => {\n      return path === join(parentPath, 'sanity.config.ts')\n    })\n\n    const result = findProjectRootSync(mockCwd)\n    expect(result).toEqual({\n      directory: parentPath,\n      path: join(parentPath, 'sanity.config.ts'),\n      type: 'studio',\n    })\n  })\n\n  test('throws error when no config is found', async () => {\n    const {existsSync, readFileSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockReturnValue(false)\n    vi.mocked(readFileSync).mockReturnValue(JSON.stringify({root: false}))\n\n    expect(() => findProjectRootSync(mockCwd)).toThrow('No project root found')\n  })\n\n  test('throws error when v2 studio root is found', async () => {\n    const {existsSync, readFileSync} = await import('node:fs')\n\n    vi.mocked(existsSync).mockReturnValue(false)\n    vi.mocked(readFileSync).mockReturnValue(JSON.stringify({root: true}))\n\n    expect(() => findProjectRootSync(mockCwd)).toThrow(\n      \"Found 'sanity.json' at /mock/project/path - Sanity Studio < v3 is no longer supported\",\n    )\n  })\n})\n"],"names":["join","afterEach","beforeEach","describe","expect","test","vi","findProjectRootSync","mock","actual","importActual","existsSync","fn","readFileSync","mockCwd","clearAllMocks","resetAllMocks","mocked","mockImplementation","path","result","toEqual","directory","type","parentPath","mockReturnValue","JSON","stringify","root","toThrow"],"mappings":"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"}
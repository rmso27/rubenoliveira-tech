{"version":3,"sources":["../../src/test/mockSanityCommand.ts"],"sourcesContent":["import {type Command} from '@oclif/core'\nimport {type CliConfig, type ProjectRootResult, SanityCommand} from '@sanity/cli-core'\n\nexport interface MockSanityCommandOptions {\n  /**\n   * Mock CLI config (required if command uses getCliConfig or getProjectId)\n   */\n  cliConfig?: CliConfig\n  /**\n   * Mock whether the terminal is interactive (used by isUnattended)\n   */\n  isInteractive?: boolean\n  /**\n   * Mock project root result (required if command uses getProjectRoot)\n   */\n  projectRoot?: ProjectRootResult\n  /**\n   * Mock authentication token (passed to API clients, bypasses getCliToken)\n   */\n  token?: string\n}\n\n/**\n * Creates a testable subclass of a command with mocked SanityCommand dependencies.\n *\n * @example\n * ```ts\n * // Basic config mocking\n * const TestAdd = mockSanityCommand(Add, {\n *   cliConfig: { api: { projectId: 'test-project' } }\n * })\n *\n * // With mock API client\n * const mockClient = {\n *   getDocument: vi.fn().mockResolvedValue({ _id: 'doc1', title: 'Test' }),\n *   fetch: vi.fn().mockResolvedValue([]),\n * }\n * const TestGet = mockSanityCommand(GetDocumentCommand, {\n *   cliConfig: { api: { projectId: 'test-project', dataset: 'production' } },\n *   projectApiClient: mockClient,\n * })\n *\n * const {stdout} = await testCommand(TestGet, ['doc1'])\n * expect(mockClient.getDocument).toHaveBeenCalledWith('doc1')\n * ```\n */\nexport function mockSanityCommand<T extends typeof SanityCommand<typeof Command>>(\n  CommandClass: T,\n  options: MockSanityCommandOptions = {},\n): T {\n  // Create a subclass that overrides methods when mocks are provided\n  // Note: we use @ts-expect-error because TypeScript can't properly infer\n  // the relationship between the generic CommandClass and SanityCommand\n  // @ts-expect-error - TypeScript struggles with abstract class subclassing\n  class MockedCommand extends CommandClass {\n    protected getCliConfig(): Promise<CliConfig> {\n      if (options.cliConfig) {\n        return Promise.resolve(options.cliConfig)\n      }\n      return super.getCliConfig()\n    }\n\n    protected getProjectRoot(): Promise<ProjectRootResult> {\n      if (options.projectRoot) {\n        return Promise.resolve(options.projectRoot)\n      }\n      return super.getProjectRoot()\n    }\n\n    protected resolveIsInteractive(): boolean {\n      if (options.isInteractive !== undefined) {\n        return options.isInteractive\n      }\n      return super.resolveIsInteractive()\n    }\n  }\n\n  return MockedCommand as T\n}\n"],"names":["mockSanityCommand","CommandClass","options","MockedCommand","getCliConfig","cliConfig","Promise","resolve","getProjectRoot","projectRoot","resolveIsInteractive","isInteractive","undefined"],"mappings":"AAsBA;;;;;;;;;;;;;;;;;;;;;;;CAuBC,GACD,OAAO,SAASA,kBACdC,YAAe,EACfC,UAAoC,CAAC,CAAC;IAEtC,mEAAmE;IACnE,wEAAwE;IACxE,sEAAsE;IACtE,0EAA0E;IAC1E,MAAMC,sBAAsBF;QAChBG,eAAmC;YAC3C,IAAIF,QAAQG,SAAS,EAAE;gBACrB,OAAOC,QAAQC,OAAO,CAACL,QAAQG,SAAS;YAC1C;YACA,OAAO,KAAK,CAACD;QACf;QAEUI,iBAA6C;YACrD,IAAIN,QAAQO,WAAW,EAAE;gBACvB,OAAOH,QAAQC,OAAO,CAACL,QAAQO,WAAW;YAC5C;YACA,OAAO,KAAK,CAACD;QACf;QAEUE,uBAAgC;YACxC,IAAIR,QAAQS,aAAa,KAAKC,WAAW;gBACvC,OAAOV,QAAQS,aAAa;YAC9B;YACA,OAAO,KAAK,CAACD;QACf;IACF;IAEA,OAAOP;AACT"}
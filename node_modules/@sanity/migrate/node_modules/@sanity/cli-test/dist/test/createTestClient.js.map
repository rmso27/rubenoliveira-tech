{"version":3,"sources":["../../src/test/createTestClient.ts"],"sourcesContent":["import {type ClientConfig, createClient} from '@sanity/client'\nimport {vi} from 'vitest'\n\nexport interface CreateTestClientOptions extends ClientConfig {\n  /**\n   * API version for the client\n   */\n  apiVersion: string\n\n  /**\n   * Authentication token\n   */\n  token: string\n}\n\n/**\n * Creates a real Sanity client instance for testing that makes actual HTTP requests.\n * Use with mockApi() to intercept and mock the HTTP calls.\n *\n * @example\n * ```typescript\n * // Mock getGlobalCliClient to return a test client\n * vi.mock('@sanity/cli-core', async (importOriginal) => {\n *   const actual = await importOriginal<typeof import('@sanity/cli-core')>()\n *   const {createTestClient} = await import('@sanity/cli-test')\n *\n *   return {\n *     ...actual,\n *     getGlobalCliClient: vi.fn().mockImplementation((opts) => {\n *       return Promise.resolve(createTestClient({\n *         apiVersion: opts.apiVersion,\n *       }))\n *     }),\n *   }\n * })\n *\n * // Then use mockApi to intercept requests\n * mockApi({\n *   apiVersion: 'v2025-02-19',\n *   method: 'get',\n *   uri: '/media-libraries',\n * }).reply(200, {data: [...]})\n * ```\n */\nexport function createTestClient(options: CreateTestClientOptions) {\n  const {apiVersion, projectId, token, ...rest} = options\n\n  const client = createClient({\n    apiVersion,\n    projectId,\n    requestTagPrefix: 'sanity.cli',\n    token,\n    useCdn: false,\n    useProjectHostname: projectId ? true : false,\n    ...rest,\n  })\n\n  /**\n   * Mock the request method of the client to return the actual response from the client\n   */\n  const request = vi.fn((...args: Parameters<typeof client.request>) => client.request(...args))\n\n  return {\n    client,\n    request,\n  }\n}\n"],"names":["createClient","vi","createTestClient","options","apiVersion","projectId","token","rest","client","requestTagPrefix","useCdn","useProjectHostname","request","fn","args"],"mappings":"AAAA,SAA2BA,YAAY,QAAO,iBAAgB;AAC9D,SAAQC,EAAE,QAAO,SAAQ;AAczB;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA4BC,GACD,OAAO,SAASC,iBAAiBC,OAAgC;IAC/D,MAAM,EAACC,UAAU,EAAEC,SAAS,EAAEC,KAAK,EAAE,GAAGC,MAAK,GAAGJ;IAEhD,MAAMK,SAASR,aAAa;QAC1BI;QACAC;QACAI,kBAAkB;QAClBH;QACAI,QAAQ;QACRC,oBAAoBN,YAAY,OAAO;QACvC,GAAGE,IAAI;IACT;IAEA;;GAEC,GACD,MAAMK,UAAUX,GAAGY,EAAE,CAAC,CAAC,GAAGC,OAA4CN,OAAOI,OAAO,IAAIE;IAExF,OAAO;QACLN;QACAI;IACF;AACF"}
import { evaluate, parse } from 'groq-js';
import { filter as filterIt } from './filter.js';
function parseGroqFilter(filter) {
    try {
        return parse(`*[${filter}]`);
    }
    catch (err) {
        if (err instanceof Error) {
            err.message = `Failed to parse GROQ filter "${filter}": ${err.message}`;
            throw err;
        }
        throw new Error(`Failed to parse GROQ filter "${filter}": ${String(err)}`);
    }
}
export async function matchesFilter(parsedFilter, document) {
    const result = await (await evaluate(parsedFilter, { dataset: [document] })).get();
    return result.length === 1;
}
export function groqFilter(documents, filter) {
    const parsedFilter = parseGroqFilter(`*[${filter}]`);
    return filterIt(documents, (doc) => matchesFilter(parsedFilter, doc));
}
//# sourceMappingURL=groqFilter.js.map